<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Subscription Copilot ‚Äî Visual Prototype</title>
  <style>
    :root{
      --bg:#0a0a0f;
      --surface:#12121a;
      --surface2:#161622;
      --border:#2a2a3a;
      --text:#e4e4e7;
      --muted:#9ca3af;
      --muted2:#71717a;
      --accent:#6366f1;
      --accent2:#a855f7;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --chip:#0f172a;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,system-ui,sans-serif;
      background:radial-gradient(1200px 600px at 20% -10%, rgba(99,102,241,0.18), transparent 60%),
                 radial-gradient(1200px 600px at 90% 0%, rgba(168,85,247,0.16), transparent 60%),
                 var(--bg);
      color:var(--text);
      min-height:100vh;
      line-height:1.4;
    }

    a{color:inherit}

    .prototype-badge{
      position:fixed; right:14px; bottom:14px;
      background:rgba(245,158,11,0.92);
      color:#111827;
      padding:10px 12px;
      border-radius:10px;
      font-weight:700;
      font-size:12px;
      z-index:999;
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
    }

    .header{
      position:sticky; top:0; z-index:50;
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 18px;
      background:rgba(18,18,26,0.85);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .brand{display:flex; gap:10px; align-items:center;}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 12px 30px rgba(99,102,241,0.25);
    }
    .brand h1{font-size:14px; letter-spacing:0.2px}
    .brand p{font-size:12px;color:var(--muted2)}

    .tabs{display:flex; gap:8px; align-items:center;}
    .tab{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-size:13px;
      transition:all .15s ease;
    }
    .tab:hover{border-color:rgba(99,102,241,0.7); color:var(--text)}
    .tab.active{background:rgba(99,102,241,0.12); border-color:rgba(99,102,241,0.6); color:var(--text)}

    .header-actions{display:flex; gap:10px; align-items:center;}

    .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:var(--surface2);
      color:var(--text);
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      transition:transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .btn:hover{border-color:rgba(99,102,241,0.7); transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg, rgba(99,102,241,1), rgba(168,85,247,1)); border-color:transparent}
    .btn.primary:hover{filter:brightness(1.05)}
    .btn.ghost{background:transparent}
    .btn.success{background:rgba(34,197,94,0.15); border-color:rgba(34,197,94,0.4); color:var(--good)}

    .container{max-width:1200px;margin:0 auto;padding:18px}
    
    .hero{
      padding:18px;
      border:1px solid var(--border);
      border-radius:16px;
      background:rgba(18,18,26,0.7);
      display:flex; justify-content:space-between; gap:16px; align-items:flex-start;
    }
    .hero h2{font-size:22px; line-height:1.15; margin-bottom:6px}
    .hero p{color:var(--muted); max-width:680px}

    .kpis{display:flex; gap:12px; flex-wrap:wrap; justify-content:flex-end}
    .kpi{
      min-width:160px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(22,22,34,0.75);
    }
    .kpi .label{color:var(--muted2); font-size:12px}
    .kpi .value{font-size:20px; font-weight:800; margin-top:2px}
    .kpi .sub{font-size:12px; color:var(--muted); margin-top:2px}

    .grid{display:grid; grid-template-columns: 1.6fr 1fr; gap:14px; margin-top:14px}
    @media (max-width: 920px){ .grid{grid-template-columns:1fr} }

    .panel{
      border:1px solid var(--border);
      background:rgba(18,18,26,0.7);
      border-radius:16px;
      overflow:hidden;
    }
    .panel-header{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--border);
      background:rgba(18,18,26,0.9);
    }
    .panel-header h3{font-size:13px; letter-spacing:0.2px}
    .panel-header .meta{color:var(--muted2); font-size:12px}
    .panel-body{padding:12px 14px}

    .search{display:flex; gap:10px; align-items:center}
    .input{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(22,22,34,0.65);
      color:var(--text);
      outline:none;
    }
    .input:focus{border-color:rgba(99,102,241,0.8)}

    .table{width:100%; border-collapse:collapse;}
    .table th{
      text-align:left;
      font-size:12px;
      color:var(--muted2);
      padding:10px 8px;
      border-bottom:1px solid rgba(42,42,58,0.7);
    }
    .table td{
      padding:12px 8px;
      border-bottom:1px solid rgba(42,42,58,0.45);
      vertical-align:top;
    }
    .row-title{font-weight:700}
    .row-sub{color:var(--muted2); font-size:12px; margin-top:2px}

    .chip{
      display:inline-flex; align-items:center;
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
      background:rgba(15,23,42,0.7);
      border:1px solid rgba(42,42,58,0.8);
      color:var(--muted);
      white-space:nowrap;
    }
    .chip.good{border-color:rgba(34,197,94,0.4); color:rgba(34,197,94,0.95); background:rgba(34,197,94,0.08)}
    .chip.warn{border-color:rgba(245,158,11,0.45); color:rgba(245,158,11,0.95); background:rgba(245,158,11,0.08)}
    .chip.bad{border-color:rgba(239,68,68,0.4); color:rgba(239,68,68,0.95); background:rgba(239,68,68,0.08)}
    .chip.accent{border-color:rgba(99,102,241,0.4); color:rgba(129,140,248,0.95); background:rgba(99,102,241,0.08)}

    .row-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .mini{
      padding:7px 10px;
      font-size:12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(22,22,34,0.75);
      color:var(--text);
      cursor:pointer;
    }
    .mini:hover{border-color:rgba(99,102,241,0.7)}
    .mini.danger:hover{border-color:rgba(239,68,68,0.6)}

    .card{
      border:1px solid rgba(42,42,58,0.8);
      border-radius:14px;
      padding:12px;
      background:rgba(22,22,34,0.55);
      margin-bottom:10px;
    }
    .card h4{font-size:13px; margin-bottom:6px}
    .card p{font-size:12px; color:var(--muted);}

    .list{display:flex; flex-direction:column; gap:10px}
    .item{display:flex; justify-content:space-between; gap:12px; align-items:flex-start}
    .item .left{min-width:0}
    .item .right{white-space:nowrap; text-align:right}
    .item .name{font-weight:700}
    .item .desc{font-size:12px; color:var(--muted2); margin-top:2px}

    /* Import options grid */
    .import-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:12px;
      margin-top:12px;
    }
    .import-card{
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      background:rgba(22,22,34,0.55);
      cursor:pointer;
      transition: all 0.15s ease;
      text-align:center;
    }
    .import-card:hover{
      border-color:rgba(99,102,241,0.6);
      transform:translateY(-2px);
    }
    .import-card.connected{
      border-color:rgba(34,197,94,0.5);
      background:rgba(34,197,94,0.05);
    }
    .import-icon{
      font-size:32px;
      margin-bottom:8px;
    }
    .import-card h4{font-size:14px; margin-bottom:4px}
    .import-card p{font-size:12px; color:var(--muted)}
    .import-card .status{
      margin-top:8px;
      font-size:11px;
      font-weight:600;
    }

    /* Detected subscriptions list */
    .detected-list{
      margin-top:14px;
    }
    .detected-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px;
      border:1px solid var(--border);
      border-radius:12px;
      margin-bottom:8px;
      background:rgba(22,22,34,0.5);
    }
    .detected-item.new{
      border-color:rgba(99,102,241,0.4);
      background:rgba(99,102,241,0.05);
    }
    .detected-item .info{display:flex; align-items:center; gap:12px}
    .detected-item .icon{
      width:40px;height:40px;
      border-radius:10px;
      background:var(--surface2);
      display:flex;align-items:center;justify-content:center;
      font-size:18px;
    }
    .detected-item .details h5{font-size:14px; font-weight:700}
    .detected-item .details p{font-size:12px; color:var(--muted)}
    .detected-item .actions{display:flex; gap:8px}

    /* Scanning animation */
    .scanning{
      display:flex;
      align-items:center;
      gap:12px;
      padding:16px;
      border:1px solid rgba(99,102,241,0.3);
      border-radius:14px;
      background:rgba(99,102,241,0.05);
      margin-top:14px;
    }
    .scanning .spinner{
      width:24px;height:24px;
      border:3px solid var(--border);
      border-top-color:var(--accent);
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .scanning .text{font-size:13px}
    .scanning .text span{color:var(--muted)}

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,0.55);
      display:none;
      align-items:center; justify-content:center;
      padding:16px;
      z-index:200;
    }
    .modal{
      width:min(720px, 100%);
      max-height:90vh;
      overflow-y:auto;
      border:1px solid var(--border);
      border-radius:18px;
      background:rgba(18,18,26,0.98);
      box-shadow:0 20px 60px rgba(0,0,0,0.6);
    }
    .modal-header{display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid var(--border)}
    .modal-header h3{font-size:14px}
    .modal-header button{background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:20px; padding:4px}
    .modal-body{padding:14px}
    .modal-actions{display:flex; justify-content:flex-end; gap:10px; margin-top:12px}

    .form{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 650px){ .form{grid-template-columns:1fr} }
    .field label{display:block; font-size:12px; color:var(--muted2); margin-bottom:6px}
    .select, .text{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(22,22,34,0.75);
      color:var(--text);
      outline:none;
    }

    /* Permission callout */
    .permission-box{
      padding:14px;
      border:1px solid rgba(245,158,11,0.3);
      border-radius:12px;
      background:rgba(245,158,11,0.05);
      margin-bottom:14px;
    }
    .permission-box h5{font-size:13px; color:var(--warn); margin-bottom:6px}
    .permission-box p{font-size:12px; color:var(--muted)}
    .permission-box ul{font-size:12px; color:var(--muted); margin:8px 0 0 18px}

    .toast{
      position:fixed; top:16px; right:16px;
      background:rgba(22,22,34,0.95);
      border:1px solid rgba(99,102,241,0.5);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      min-width:240px;
      box-shadow:0 16px 40px rgba(0,0,0,0.5);
      display:none;
      z-index:400;
    }
    .toast .t-title{font-weight:800; font-size:13px}
    .toast .t-body{font-size:12px; color:var(--muted); margin-top:4px}

    @keyframes fadeInUp{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)}}
    .animate{animation:fadeInUp .35s ease-out both}
  </style>
</head>
<body>
  <div class="prototype-badge">Visual Prototype v2 ‚Äî 2026-02-03</div>

  <header class="header">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Subscription Copilot</h1>
        <p>Auto-detect ‚Ä¢ track renewals ‚Ä¢ cancel faster</p>
      </div>
    </div>

    <div class="tabs" role="tablist">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="import">Import</button>
      <button class="tab" data-tab="savings">Savings</button>
      <button class="tab" data-tab="settings">Settings</button>
    </div>

    <div class="header-actions">
      <button class="btn success" id="btnImport">üì• Connect sources</button>
    </div>
  </header>

  <main class="container">

    <section class="hero animate">
      <div>
        <h2>Your subscriptions, auto-detected.</h2>
        <p>
          Connect your email or bank ‚Äî we scan for recurring charges and receipts automatically.
          No manual entry needed. Just review and take action.
        </p>
      </div>
      <div class="kpis">
        <div class="kpi">
          <div class="label">Monthly total</div>
          <div class="value" id="kpiTotal">‚Ç¨0</div>
          <div class="sub" id="kpiCount">0 subscriptions tracked</div>
        </div>
        <div class="kpi">
          <div class="label">Next 7 days</div>
          <div class="value" id="kpiNext">‚Ç¨0</div>
          <div class="sub">renewals coming up</div>
        </div>
        <div class="kpi">
          <div class="label">Potential savings</div>
          <div class="value" id="kpiSave">‚Ç¨0</div>
          <div class="sub">if you downgrade/cancel</div>
        </div>
      </div>
    </section>

    <!-- Import sources panel (hidden initially, shown when clicking Import tab or button) -->
    <section class="panel animate" id="importPanel" style="margin-top:14px; display:none;">
      <div class="panel-header">
        <div>
          <h3>üîå Connect your sources</h3>
          <div class="meta">We auto-detect subscriptions from receipts and recurring charges.</div>
        </div>
      </div>
      <div class="panel-body">
        <div class="import-grid">
          <div class="import-card" id="importGmail">
            <div class="import-icon">üìß</div>
            <h4>Gmail</h4>
            <p>Scan receipt emails for subscriptions</p>
            <div class="status" style="color:var(--muted2)">Click to connect</div>
          </div>
          <div class="import-card" id="importOutlook">
            <div class="import-icon">üì¨</div>
            <h4>Outlook / iCloud</h4>
            <p>Works with any email provider</p>
            <div class="status" style="color:var(--muted2)">Click to connect</div>
          </div>
          <div class="import-card" id="importBank">
            <div class="import-icon">üè¶</div>
            <h4>Bank / Card</h4>
            <p>Detect recurring charges via Plaid</p>
            <div class="status" style="color:var(--muted2)">Click to connect</div>
          </div>
          <div class="import-card" id="importForward">
            <div class="import-icon">üì®</div>
            <h4>Forward receipts</h4>
            <p>Auto-forward to receipts@subcopilot.io</p>
            <div class="status" style="color:var(--muted2)">Get your address</div>
          </div>
        </div>

        <div id="scanningStatus" style="display:none;"></div>
        <div id="detectedSubs" style="display:none;"></div>

        <div style="margin-top:16px; text-align:center">
          <button class="btn ghost" id="btnManualAdd" style="font-size:12px">Or add manually as fallback ‚Üí</button>
        </div>
      </div>
    </section>

    <section class="grid" id="mainGrid">
      <div class="panel animate" id="panelMain">
        <div class="panel-header">
          <div>
            <h3 id="mainTitle">Your subscriptions</h3>
            <div class="meta" id="mainMeta">Auto-detected from your connected sources.</div>
          </div>
          <div class="search" style="width: 320px;">
            <input class="input" id="search" placeholder="Search (Netflix, Gym, Claude‚Ä¶)" />
          </div>
        </div>

        <div class="panel-body">
          <div id="emptyState" style="text-align:center; padding:40px 20px; display:none;">
            <div style="font-size:48px; margin-bottom:12px">üì≠</div>
            <h4 style="margin-bottom:8px">No subscriptions yet</h4>
            <p style="color:var(--muted); margin-bottom:16px">Connect your email or bank to auto-detect your recurring payments.</p>
            <button class="btn primary" id="btnEmptyConnect">Connect sources</button>
          </div>
          <div style="overflow:auto;">
            <table class="table" id="subsTable">
              <thead>
                <tr>
                  <th>Subscription</th>
                  <th>Monthly</th>
                  <th>Renewal</th>
                  <th>Source</th>
                  <th style="text-align:right;">Actions</th>
                </tr>
              </thead>
              <tbody id="subsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <aside class="panel animate" id="panelSide">
        <div class="panel-header">
          <div>
            <h3>Today's focus</h3>
            <div class="meta">What you can do in 2 minutes.</div>
          </div>
        </div>
        <div class="panel-body">
          <div class="card">
            <h4>üéØ Top 3 wastes</h4>
            <p>Based on price creep, low usage, and renewals you might forget.</p>
            <div class="list" id="wasteList" style="margin-top:10px"></div>
          </div>

          <div class="card">
            <h4>‚è∞ Upcoming renewals</h4>
            <p>Decide before you get charged.</p>
            <div class="list" id="renewList" style="margin-top:10px"></div>
          </div>

          <div class="card">
            <h4>üí° Curated alternatives</h4>
            <p>Human-picked swaps, not AI spam.</p>
            <div class="list" id="altList" style="margin-top:10px"></div>
          </div>
        </div>
      </aside>
    </section>

  </main>

  <!-- Gmail connect modal -->
  <div class="modal-backdrop" id="gmailModal">
    <div class="modal">
      <div class="modal-header">
        <h3>üìß Connect Gmail</h3>
        <button id="gmailClose">√ó</button>
      </div>
      <div class="modal-body">
        <div class="permission-box">
          <h5>üîí Privacy first</h5>
          <p>We only scan for subscription receipts. We never read personal emails, and you can disconnect anytime.</p>
          <ul>
            <li>Read-only access to emails from known services</li>
            <li>Pattern matching for receipts only</li>
            <li>Data stays on your device (or encrypted)</li>
          </ul>
        </div>
        
        <div style="text-align:center; padding:20px 0;">
          <button class="btn primary" id="btnGmailAuth" style="font-size:15px; padding:14px 28px">
            Sign in with Google
          </button>
          <p style="font-size:11px; color:var(--muted2); margin-top:10px">
            OAuth 2.0 ‚Äî we never see your password
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bank connect modal -->
  <div class="modal-backdrop" id="bankModal">
    <div class="modal">
      <div class="modal-header">
        <h3>üè¶ Connect Bank / Card</h3>
        <button id="bankClose">√ó</button>
      </div>
      <div class="modal-body">
        <div class="permission-box">
          <h5>üîí Powered by Plaid</h5>
          <p>We use Plaid to securely connect to your bank. We only look for recurring transactions.</p>
          <ul>
            <li>Bank-grade encryption</li>
            <li>Read-only access to transaction history</li>
            <li>Detects recurring charges automatically</li>
          </ul>
        </div>
        
        <div style="text-align:center; padding:20px 0;">
          <button class="btn primary" id="btnBankAuth" style="font-size:15px; padding:14px 28px">
            Connect with Plaid
          </button>
          <p style="font-size:11px; color:var(--muted2); margin-top:10px">
            Trusted by millions ‚Äî disconnect anytime
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Forward receipts modal -->
  <div class="modal-backdrop" id="forwardModal">
    <div class="modal">
      <div class="modal-header">
        <h3>üì® Forward receipts</h3>
        <button id="forwardClose">√ó</button>
      </div>
      <div class="modal-body">
        <p style="color:var(--muted); margin-bottom:16px">Forward your subscription receipts to this address and we'll parse them automatically.</p>
        
        <div style="background:var(--surface2); border:1px solid var(--border); border-radius:12px; padding:16px; text-align:center; margin-bottom:16px">
          <p style="font-size:11px; color:var(--muted2); margin-bottom:6px">Your personal receipt inbox:</p>
          <p style="font-size:16px; font-weight:700; color:var(--accent); user-select:all" id="forwardEmail">sami-xyz123@receipts.subcopilot.io</p>
          <button class="btn" style="margin-top:10px" id="btnCopyEmail">üìã Copy address</button>
        </div>
        
        <p style="font-size:12px; color:var(--muted)">
          <strong>Tip:</strong> Set up an email filter to auto-forward receipts from Netflix, Spotify, etc.
        </p>
      </div>
    </div>
  </div>

  <!-- Manual add modal (fallback) -->
  <div class="modal-backdrop" id="manualModal">
    <div class="modal">
      <div class="modal-header">
        <h3>‚ûï Add manually (fallback)</h3>
        <button id="manualClose">√ó</button>
      </div>
      <div class="modal-body">
        <p style="color:var(--muted); margin-bottom:14px; font-size:13px">
          Prefer to connect sources for auto-detection. Manual entry is a last resort.
        </p>
        <div class="form">
          <div class="field">
            <label>Name</label>
            <input class="text" id="fName" placeholder="e.g. Netflix" />
          </div>
          <div class="field">
            <label>Category</label>
            <select class="select" id="fCategory">
              <option>Streaming</option>
              <option>AI Tools</option>
              <option>Fitness</option>
              <option>Productivity</option>
              <option>News</option>
              <option>Other</option>
            </select>
          </div>
          <div class="field">
            <label>Monthly price (‚Ç¨)</label>
            <input class="text" id="fPrice" type="number" step="0.01" placeholder="e.g. 14.99" />
          </div>
          <div class="field">
            <label>Renewal date</label>
            <input class="text" id="fRenew" type="date" />
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn" id="btnCancelManual">Cancel</button>
          <button class="btn primary" id="btnSaveManual">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Action modal -->
  <div class="modal-backdrop" id="actionBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 id="actionTitle">Action</h3>
        <button id="actionClose">√ó</button>
      </div>
      <div class="modal-body" id="actionBody"></div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div class="t-title" id="toastTitle">Saved</div>
    <div class="t-body" id="toastBody">Demo message</div>
  </div>

  <script>
    const today = new Date("2026-02-03T10:00:00");

    // State
    let sources = {
      gmail: false,
      outlook: false,
      bank: false,
      forward: false
    };

    let subs = [];

    const demoSubs = [
      { id: crypto.randomUUID(), name: "Claude Pro", category: "AI Tools", monthly: 20.00, renewal: "2026-02-09", lastMonthly: 20.00, signal: "pricey", source: "gmail", notes: "Receipt detected from Anthropic" },
      { id: crypto.randomUUID(), name: "Gym Membership", category: "Fitness", monthly: 49.90, renewal: "2026-02-06", lastMonthly: 39.90, signal: "price_creep", source: "bank", notes: "Recurring charge +‚Ç¨10 from last month" },
      { id: crypto.randomUUID(), name: "X Premium", category: "Other", monthly: 16.00, renewal: "2026-02-11", lastMonthly: 16.00, signal: "annoying", source: "bank", notes: "Recurring charge detected" },
      { id: crypto.randomUUID(), name: "Netflix", category: "Streaming", monthly: 14.99, renewal: "2026-02-24", lastMonthly: 13.99, signal: "price_creep", source: "gmail", notes: "Receipt from Netflix" },
      { id: crypto.randomUUID(), name: "Notion", category: "Productivity", monthly: 10.00, renewal: "2026-02-20", lastMonthly: 10.00, signal: "ok", source: "gmail", notes: "Receipt detected" },
      { id: crypto.randomUUID(), name: "Spotify", category: "Streaming", monthly: 10.99, renewal: "2026-02-15", lastMonthly: 9.99, signal: "price_creep", source: "bank", notes: "Monthly charge detected" },
    ];

    const curatedAlternatives = {
      // Streaming
      "Netflix": [{ title: "Rotate streaming", desc: "1 month on, 2 months off. Save ‚Ç¨8/mo average." }],
      "Spotify": [{ title: "Family plan", desc: "Split with 5 friends = ‚Ç¨3/mo each." }],
      "Disney+": [{ title: "Annual plan", desc: "Pay yearly = 2 months free." }],
      "YouTube Premium": [{ title: "Browser extension", desc: "uBlock Origin blocks ads for free." }],
      "HBO Max": [{ title: "Rotate with Netflix", desc: "Alternate months between services." }],
      "Amazon Prime": [{ title: "Share household", desc: "Add 1 adult + 4 teens for free." }],
      
      // AI Tools
      "Claude Pro": [{ title: "Mix models", desc: "Use GPT-5.2 for simple tasks, Claude for complex." }],
      "ChatGPT Plus": [{ title: "Use free tier + Claude", desc: "Alternate between free tiers." }],
      "Cursor": [{ title: "VS Code + Copilot", desc: "GitHub Copilot at $10/mo or free for students." }],
      
      // Developer
      "GitHub Pro": [{ title: "Free for open source", desc: "Public repos get Pro features free." }],
      "Vercel": [{ title: "Hobby tier", desc: "Free tier covers most personal projects." }],
      "Render": [{ title: "Use free tier", desc: "Spin down when not in use." }],
      "Heroku": [{ title: "Switch to Render/Railway", desc: "Better free tiers available." }],
      
      // Productivity
      "Notion": [{ title: "Personal free tier", desc: "Unlimited blocks for individuals." }],
      "Slack": [{ title: "Discord", desc: "Free with better features for small teams." }],
      "Linear": [{ title: "GitHub Issues", desc: "Free built-in project management." }],
      
      // Design
      "Adobe Creative Cloud": [{ title: "Affinity Suite", desc: "One-time ‚Ç¨70 vs ‚Ç¨720/year." }],
      "Figma": [{ title: "Free tier", desc: "3 projects free, enough for freelancers." }],
      "Canva": [{ title: "Free tier + templates", desc: "Most features free with ads." }],
      
      // Cloud
      "Dropbox": [{ title: "Google Drive", desc: "15GB free vs 2GB on Dropbox." }],
      "Google One": [{ title: "iCloud for Apple users", desc: "Better integration, same price." }],
      "iCloud+": [{ title: "Google Drive", desc: "15GB free, works everywhere." }],
      
      // Other
      "Medium": [{ title: "Incognito mode", desc: "Or use 12ft.io to bypass paywall." }],
      "X Premium": [{ title: "Go free + RSS", desc: "Use lists and RSS readers instead." }],
      "Gym Membership": [{ title: "Pause + home workouts", desc: "Try 8-week home program." }],
      "Microsoft 365": [{ title: "Google Workspace", desc: "Free tier with 15GB storage." }],
    };

    // Helpers
    function eur(n){ return new Intl.NumberFormat(undefined, { style: 'currency', currency: 'EUR' }).format(n); }
    function daysUntil(d){ const dt = new Date(d + "T00:00:00"); return Math.ceil((dt - today) / (1000*60*60*24)); }
    function fmtDate(d){ return new Date(d + "T00:00:00").toLocaleDateString(undefined, { month: 'short', day: 'numeric' }); }
    function escapeHtml(s){ return String(s || '').replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    function signalChip(sub){
      const delta = sub.monthly - sub.lastMonthly;
      if (sub.signal === 'price_creep' && delta > 0.01) return { cls: 'warn', text: `+${eur(delta)}/mo` };
      if (sub.signal === 'pricey') return { cls: 'warn', text: 'Expensive' };
      if (sub.signal === 'annoying') return { cls: 'bad', text: 'Low value' };
      return { cls: 'good', text: 'OK' };
    }

    function sourceIcon(src){
      if (src === 'gmail') return 'üìß';
      if (src === 'bank') return 'üè¶';
      if (src === 'forward') return 'üì®';
      if (src === 'manual') return '‚úèÔ∏è';
      return 'üì•';
    }

    function computeKpis(){
      const total = subs.reduce((a,s)=>a+s.monthly,0);
      const upcoming = subs.filter(s => { const d = daysUntil(s.renewal); return d >= 0 && d <= 7; }).reduce((a,s)=>a+s.monthly,0);
      const savings = subs.reduce((a,s)=>{
        if (s.signal === 'annoying') return a + (s.monthly * 0.6);
        if (s.signal === 'price_creep') return a + Math.max(0, s.monthly - s.lastMonthly);
        if (s.signal === 'pricey') return a + (s.monthly * 0.25);
        return a;
      }, 0);
      document.getElementById('kpiTotal').textContent = eur(total);
      document.getElementById('kpiCount').textContent = `${subs.length} subscriptions tracked`;
      document.getElementById('kpiNext').textContent = eur(upcoming);
      document.getElementById('kpiSave').textContent = eur(savings);
    }

    function renderTable(filter=""){
      const tbody = document.getElementById('subsBody');
      const empty = document.getElementById('emptyState');
      const table = document.getElementById('subsTable');

      if (subs.length === 0) {
        empty.style.display = 'block';
        table.style.display = 'none';
        return;
      }
      empty.style.display = 'none';
      table.style.display = '';

      tbody.innerHTML = '';
      const list = subs.filter(s => !filter || (s.name + s.category + s.notes).toLowerCase().includes(filter.toLowerCase()))
                       .sort((a,b) => daysUntil(a.renewal) - daysUntil(b.renewal));

      for (const s of list) {
        const due = daysUntil(s.renewal);
        const chip = signalChip(s);
        const renewCls = due <= 3 ? 'bad' : (due <= 7 ? 'warn' : 'good');
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div class="row-title">${escapeHtml(s.name)}</div>
            <div class="row-sub">${escapeHtml(s.category)} ‚Ä¢ ${escapeHtml(s.notes || '')}</div>
          </td>
          <td>
            <div style="font-weight:800">${eur(s.monthly)}</div>
            ${s.lastMonthly !== s.monthly ? `<div class="row-sub">was ${eur(s.lastMonthly)}</div>` : ''}
          </td>
          <td>
            <div style="font-weight:800">${fmtDate(s.renewal)}</div>
            <div class="row-sub"><span class="chip ${renewCls}">${due < 0 ? 'overdue' : due + 'd'}</span></div>
          </td>
          <td>
            <span class="chip accent">${sourceIcon(s.source)} ${s.source}</span>
          </td>
          <td style="text-align:right">
            <div class="row-actions">
              <button class="mini" data-action="alts" data-id="${s.id}">Alternatives</button>
              <button class="mini danger" data-action="cancel" data-id="${s.id}">Cancel</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      }

      tbody.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const sub = subs.find(x => x.id === btn.dataset.id);
          openAction(btn.dataset.action, sub);
        });
      });
    }

    function renderSide(){
      // Top wastes
      const wastes = [...subs].map(s => ({ s, score: (signalChip(s).cls === 'bad' ? 3 : signalChip(s).cls === 'warn' ? 2 : 1) + s.monthly/25 }))
        .sort((a,b)=>b.score-a.score).slice(0,3);
      document.getElementById('wasteList').innerHTML = wastes.map(({s}) => `
        <div class="item">
          <div class="left"><div class="name">${escapeHtml(s.name)}</div><div class="desc">${eur(s.monthly)} ‚Ä¢ ${s.category}</div></div>
          <div class="right"><span class="chip ${signalChip(s).cls}">${signalChip(s).text}</span></div>
        </div>
      `).join('');

      // Upcoming
      const upcoming = [...subs].map(s=>({s, due: daysUntil(s.renewal)})).filter(x=>x.due>=0).sort((a,b)=>a.due-b.due).slice(0,4);
      document.getElementById('renewList').innerHTML = upcoming.map(({s,due}) => `
        <div class="item">
          <div class="left"><div class="name">${escapeHtml(s.name)}</div><div class="desc">in ${due}d ‚Ä¢ ${fmtDate(s.renewal)}</div></div>
          <div class="right"><span class="chip ${due<=3?'bad':due<=7?'warn':'good'}">${eur(s.monthly)}</span></div>
        </div>
      `).join('');

      // Alternatives
      const alts = [...subs].sort((a,b)=>b.monthly-a.monthly).slice(0,3);
      document.getElementById('altList').innerHTML = alts.map(s => {
        const alt = (curatedAlternatives[s.name] || [{ title: 'No suggestion yet', desc: 'Check back soon.' }])[0];
        return `
          <div class="item">
            <div class="left"><div class="name">${escapeHtml(s.name)} ‚Üí ${escapeHtml(alt.title)}</div><div class="desc">${escapeHtml(alt.desc)}</div></div>
            <div class="right"><button class="mini" style="padding:6px 8px" onclick="toastShow('Saved','Added to your plan.')">Save</button></div>
          </div>
        `;
      }).join('');
    }

    function renderAll(){
      computeKpis();
      renderTable(document.getElementById('search').value);
      renderSide();
      updateSourceCards();
    }

    function updateSourceCards(){
      ['gmail','outlook','bank','forward'].forEach(src => {
        const card = document.getElementById('import' + src.charAt(0).toUpperCase() + src.slice(1));
        if (!card) return;
        if (sources[src]) {
          card.classList.add('connected');
          card.querySelector('.status').textContent = '‚úì Connected';
          card.querySelector('.status').style.color = 'var(--good)';
        }
      });
    }

    // Modal helpers
    function openModal(id){ document.getElementById(id).style.display = 'flex'; }
    function closeModal(id){ document.getElementById(id).style.display = 'none'; }

    // Gmail connect flow
    document.getElementById('importGmail').addEventListener('click', () => openModal('gmailModal'));
    document.getElementById('gmailClose').addEventListener('click', () => closeModal('gmailModal'));
    document.getElementById('gmailModal').addEventListener('click', e => { if(e.target.id==='gmailModal') closeModal('gmailModal'); });

    // Real Gmail API integration
    const API_URL = window.location.hostname === 'localhost' 
      ? 'http://localhost:3001' 
      : 'https://subscription-copilot-api.onrender.com';
    
    async function checkGmailStatus() {
      try {
        const res = await fetch(`${API_URL}/auth/status`);
        const data = await res.json();
        if (data.connected) {
          sources.gmail = true;
          updateSourceCards();
        }
      } catch (e) { console.log('Backend not available'); }
    }
    checkGmailStatus();

    document.getElementById('btnGmailAuth').addEventListener('click', async () => {
      try {
        const statusRes = await fetch(`${API_URL}/auth/status`);
        const status = await statusRes.json();
        
        if (status.connected) {
          closeModal('gmailModal');
          await scanRealGmail();
        } else {
          const authRes = await fetch(`${API_URL}/auth/gmail`);
          const authData = await authRes.json();
          const popup = window.open(authData.authUrl, 'Gmail Auth', 'width=500,height=600');
          
          window.addEventListener('message', async (ev) => {
            if (ev.data?.type === 'GMAIL_CONNECTED') {
              sources.gmail = true;
              updateSourceCards();
              closeModal('gmailModal');
              toastShow('Connected', 'Gmail linked! Scanning...');
              await scanRealGmail();
            }
          });
        }
      } catch (e) {
        // Fallback to demo mode
        closeModal('gmailModal');
        showScanning('gmail');
      }
    });

    async function scanRealGmail() {
      document.getElementById('importPanel').style.display = 'block';
      const status = document.getElementById('scanningStatus');
      status.style.display = 'block';
      status.innerHTML = `<div class="scanning"><div class="spinner"></div><div class="text"><strong>Scanning Gmail...</strong><br><span>Looking for subscription receipts</span></div></div>`;

      try {
        const res = await fetch(`${API_URL}/api/scan-subscriptions`);
        const data = await res.json();
        
        if (data.subscriptions && data.subscriptions.length > 0) {
          sources.gmail = true;
          status.innerHTML = `<div class="scanning" style="border-color:rgba(34,197,94,0.4); background:rgba(34,197,94,0.05)"><div style="font-size:24px">‚úÖ</div><div class="text"><strong style="color:var(--good)">Found ${data.subscriptions.length} subscriptions!</strong><br><span>Review and confirm below</span></div></div>`;
          showRealDetectedSubs(data.subscriptions);
        } else {
          status.innerHTML = `<div class="scanning"><div style="font-size:24px">üì≠</div><div class="text"><strong>No subscriptions found</strong><br><span>Try connecting your bank or add manually</span></div></div>`;
        }
        updateSourceCards();
      } catch (e) {
        status.innerHTML = `<div class="scanning" style="border-color:var(--bad)"><div class="text"><strong style="color:var(--bad)">Scan failed</strong><br><span>${e.message}</span></div></div>`;
      }
    }

    function showRealDetectedSubs(detected) {
      const container = document.getElementById('detectedSubs');
      container.style.display = 'block';
      container.innerHTML = `
        <div class="detected-list">
          <h4 style="margin-bottom:10px">üìã Detected subscriptions</h4>
          ${detected.map((s, i) => `
            <div class="detected-item new" data-idx="${i}">
              <div class="info">
                <div class="icon">üìß</div>
                <div class="details">
                  <h5>${escapeHtml(s.name)}</h5>
                  <p>${s.price ? eur(s.price) + '/mo' : 'Price unknown'}</p>
                </div>
              </div>
              <div class="actions">
                <button class="mini" data-add="${i}">‚úì Add</button>
                <button class="mini" data-skip="${i}">Skip</button>
              </div>
            </div>
          `).join('')}
          <div style="margin-top:12px; text-align:center">
            <button class="btn primary" id="btnAddAllReal">Add all (${detected.length})</button>
          </div>
        </div>
      `;

      container.querySelectorAll('[data-add]').forEach(btn => {
        btn.onclick = () => {
          const s = detected[parseInt(btn.dataset.add)];
          subs.push({ id: crypto.randomUUID(), name: s.name, category: s.category || 'Other', monthly: s.price || 9.99, renewal: getNextMonth(), lastMonthly: s.price || 9.99, signal: 'ok', source: 'gmail', notes: 'From Gmail' });
          btn.closest('.detected-item').style.opacity = '0.4';
          btn.textContent = 'Added';
          saveToStorage();
          renderAll();
        };
      });

      container.querySelectorAll('[data-skip]').forEach(btn => {
        btn.onclick = () => btn.closest('.detected-item').remove();
      });

      document.getElementById('btnAddAllReal')?.addEventListener('click', () => {
        detected.forEach(s => {
          if (!subs.find(x => x.name.toLowerCase() === s.name.toLowerCase())) {
            subs.push({ id: crypto.randomUUID(), name: s.name, category: s.category || 'Other', monthly: s.price || 9.99, renewal: getNextMonth(), lastMonthly: s.price || 9.99, signal: 'ok', source: 'gmail', notes: 'From Gmail' });
          }
        });
        container.innerHTML = '<p style="color:var(--good); text-align:center; padding:20px">‚úÖ All added!</p>';
        saveToStorage();
        renderAll();
      });
    }

    function getNextMonth() { const d = new Date(); d.setMonth(d.getMonth() + 1); return d.toISOString().split('T')[0]; }
    function saveToStorage() { localStorage.setItem('subs_v3', JSON.stringify(subs)); }
    function loadFromStorage() { try { const d = localStorage.getItem('subs_v3'); if (d) subs = JSON.parse(d); } catch(e){} }

    // Bank connect flow
    document.getElementById('importBank').addEventListener('click', () => openModal('bankModal'));
    document.getElementById('bankClose').addEventListener('click', () => closeModal('bankModal'));
    document.getElementById('bankModal').addEventListener('click', e => { if(e.target.id==='bankModal') closeModal('bankModal'); });

    document.getElementById('btnBankAuth').addEventListener('click', () => {
      closeModal('bankModal');
      showScanning('bank');
    });

    // Forward flow
    document.getElementById('importForward').addEventListener('click', () => openModal('forwardModal'));
    document.getElementById('forwardClose').addEventListener('click', () => closeModal('forwardModal'));
    document.getElementById('forwardModal').addEventListener('click', e => { if(e.target.id==='forwardModal') closeModal('forwardModal'); });
    document.getElementById('btnCopyEmail').addEventListener('click', () => {
      navigator.clipboard?.writeText(document.getElementById('forwardEmail').textContent);
      toastShow('Copied!', 'Paste this in your email filter.');
      sources.forward = true;
      updateSourceCards();
    });

    // Outlook (same as gmail for demo)
    document.getElementById('importOutlook').addEventListener('click', () => {
      toastShow('Outlook', 'Same OAuth flow as Gmail ‚Äî connecting...');
      setTimeout(() => showScanning('outlook'), 500);
    });

    // Scanning animation
    function showScanning(source){
      document.getElementById('importPanel').style.display = 'block';
      const status = document.getElementById('scanningStatus');
      status.style.display = 'block';
      status.innerHTML = `
        <div class="scanning">
          <div class="spinner"></div>
          <div class="text">
            <strong>Scanning ${source}...</strong><br>
            <span>Looking for subscription receipts and recurring charges</span>
          </div>
        </div>
      `;

      setTimeout(() => {
        sources[source] = true;
        status.innerHTML = `
          <div class="scanning" style="border-color:rgba(34,197,94,0.4); background:rgba(34,197,94,0.05)">
            <div style="font-size:24px">‚úÖ</div>
            <div class="text">
              <strong style="color:var(--good)">Found ${source === 'bank' ? 3 : 4} subscriptions!</strong><br>
              <span>Review and confirm below</span>
            </div>
          </div>
        `;
        showDetectedSubs(source);
        updateSourceCards();
      }, 2000);
    }

    function showDetectedSubs(source){
      const detected = demoSubs.filter(s => s.source === source || (source === 'outlook' && s.source === 'gmail'));
      const container = document.getElementById('detectedSubs');
      container.style.display = 'block';
      container.innerHTML = `
        <div class="detected-list">
          <h4 style="margin-bottom:10px">üìã Detected subscriptions</h4>
          ${detected.map(s => `
            <div class="detected-item new" data-id="${s.id}">
              <div class="info">
                <div class="icon">${sourceIcon(s.source)}</div>
                <div class="details">
                  <h5>${escapeHtml(s.name)}</h5>
                  <p>${eur(s.monthly)}/mo ‚Ä¢ renews ${fmtDate(s.renewal)}</p>
                </div>
              </div>
              <div class="actions">
                <button class="mini" data-confirm="${s.id}">‚úì Confirm</button>
                <button class="mini" data-ignore="${s.id}">Ignore</button>
              </div>
            </div>
          `).join('')}
          <div style="margin-top:12px; text-align:center">
            <button class="btn primary" id="btnConfirmAll">Confirm all (${detected.length})</button>
          </div>
        </div>
      `;

      container.querySelectorAll('[data-confirm]').forEach(btn => {
        btn.addEventListener('click', () => {
          const sub = demoSubs.find(s => s.id === btn.dataset.confirm);
          if (sub && !subs.find(s => s.id === sub.id)) {
            subs.push(sub);
            saveToStorage();
            btn.closest('.detected-item').style.opacity = '0.4';
            btn.textContent = 'Added';
            btn.disabled = true;
            renderAll();
            toastShow('Added', `${sub.name} is now tracked.`);
          }
        });
      });

      container.querySelectorAll('[data-ignore]').forEach(btn => {
        btn.addEventListener('click', () => {
          btn.closest('.detected-item').remove();
          toastShow('Ignored', 'Subscription skipped.');
        });
      });

      document.getElementById('btnConfirmAll')?.addEventListener('click', () => {
        detected.forEach(sub => {
          if (!subs.find(s => s.id === sub.id)) subs.push(sub);
        });
        saveToStorage();
        container.innerHTML = '<p style="color:var(--good); text-align:center; padding:20px">‚úÖ All subscriptions added!</p>';
        renderAll();
        toastShow('All added', `${detected.length} subscriptions now tracked.`);
      });
    }

    // Manual add (fallback)
    document.getElementById('btnManualAdd').addEventListener('click', () => openModal('manualModal'));
    document.getElementById('manualClose').addEventListener('click', () => closeModal('manualModal'));
    document.getElementById('btnCancelManual').addEventListener('click', () => closeModal('manualModal'));
    document.getElementById('manualModal').addEventListener('click', e => { if(e.target.id==='manualModal') closeModal('manualModal'); });

    document.getElementById('btnSaveManual').addEventListener('click', () => {
      const name = document.getElementById('fName').value.trim();
      const price = parseFloat(document.getElementById('fPrice').value);
      const renew = document.getElementById('fRenew').value;
      if (!name || !renew || isNaN(price)) { toastShow('Missing info', 'Fill all fields.'); return; }
      subs.push({
        id: crypto.randomUUID(), name, category: document.getElementById('fCategory').value,
        monthly: price, renewal: renew, lastMonthly: price, signal: 'ok', source: 'manual', notes: 'Manually added'
      });
      saveToStorage();
      closeModal('manualModal');
      document.getElementById('fName').value = '';
      document.getElementById('fPrice').value = '';
      document.getElementById('fRenew').value = '';
      renderAll();
      toastShow('Saved', `${name} added.`);
    });

    // Action modal
    function openAction(action, sub){
      if (!sub) return;
      openModal('actionBackdrop');
      const t = document.getElementById('actionTitle');
      const body = document.getElementById('actionBody');

      if (action === 'cancel') {
        t.textContent = `Cancel ${sub.name}`;
        body.innerHTML = `
          <p style="color:var(--muted); margin-bottom:12px">One-tap cancel instructions.</p>
          <div class="card">
            <h4>Steps to cancel</h4>
            <ol style="margin-left:18px; color:var(--muted); font-size:13px; line-height:1.7">
              <li>Open ${escapeHtml(sub.name)} account settings</li>
              <li>Go to Billing ‚Üí Manage plan</li>
              <li>Cancel before <b>${fmtDate(sub.renewal)}</b></li>
            </ol>
          </div>
          <div class="modal-actions">
            <button class="btn" onclick="navigator.clipboard?.writeText('Cancel ${escapeHtml(sub.name)} before ${sub.renewal}'); toastShow('Copied','Reminder text copied.')">Copy reminder</button>
            <button class="btn primary" id="confirmCancel">Mark as cancelled</button>
          </div>
        `;
        setTimeout(() => {
          document.getElementById('confirmCancel')?.addEventListener('click', () => {
            subs = subs.filter(s => s.id !== sub.id);
            saveToStorage();
            closeModal('actionBackdrop');
            renderAll();
            toastShow('Cancelled', `${sub.name} removed.`);
          });
        }, 0);
      }

      if (action === 'alts') {
        t.textContent = `Alternatives for ${sub.name}`;
        const alts = curatedAlternatives[sub.name] || [{ title: 'No suggestion', desc: 'Check back soon.' }];
        body.innerHTML = `
          <p style="color:var(--muted); margin-bottom:12px">Human-curated swaps (not AI spam).</p>
          ${alts.map(a => `
            <div class="card">
              <h4>${escapeHtml(a.title)}</h4>
              <p>${escapeHtml(a.desc)}</p>
              <div class="modal-actions">
                <button class="btn" onclick="toastShow('Saved','Added to your plan.')">Add to plan</button>
                <button class="btn primary" onclick="toastShow('Reminder set','We\\'ll remind you before renewal.')">Remind me</button>
              </div>
            </div>
          `).join('')}
          <div class="modal-actions"><button class="btn primary" onclick="closeModal('actionBackdrop')">Close</button></div>
        `;
      }
    }

    document.getElementById('actionClose').addEventListener('click', () => closeModal('actionBackdrop'));
    document.getElementById('actionBackdrop').addEventListener('click', e => { if(e.target.id==='actionBackdrop') closeModal('actionBackdrop'); });

    // Header buttons
    document.getElementById('btnImport').addEventListener('click', () => {
      document.getElementById('importPanel').style.display = 'block';
      document.getElementById('importPanel').scrollIntoView({ behavior: 'smooth' });
    });

    document.getElementById('btnEmptyConnect')?.addEventListener('click', () => {
      document.getElementById('importPanel').style.display = 'block';
    });

    // Tabs
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        if (tab.dataset.tab === 'import') {
          document.getElementById('importPanel').style.display = 'block';
          document.getElementById('mainGrid').style.display = 'none';
        } else {
          document.getElementById('importPanel').style.display = 'none';
          document.getElementById('mainGrid').style.display = 'grid';
        }
        if (tab.dataset.tab === 'settings') {
          toastShow('Settings', 'Configure alerts, privacy, connected sources.');
        }
      });
    });

    // Search
    document.getElementById('search').addEventListener('input', e => renderTable(e.target.value));

    // Toast
    let toastTimer;
    function toastShow(title, body){
      const t = document.getElementById('toast');
      document.getElementById('toastTitle').textContent = title;
      document.getElementById('toastBody').textContent = body;
      t.style.display = 'block';
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.style.display = 'none', 2600);
    }
    window.toastShow = toastShow;
    window.closeModal = closeModal;

    // Init - load from storage first
    loadFromStorage();
    renderAll();
    setTimeout(() => toastShow('üëã Welcome', 'Connect Gmail or Bank to auto-detect subscriptions.'), 600);
  </script>
</body>
</html>
